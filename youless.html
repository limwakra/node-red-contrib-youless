<script type="text/javascript">
    RED.nodes.registerType('youless',{
        category: 'function',
        color: '#3e9401',
        defaults: {
            name: {value:""},
            ipaddress: { value:"", validate:RED.validators.regex(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/) },
            topic: { value:""},
            page: { value:""},
            password: { value:""},
        },
        inputs:1,
        outputs:1,
        icon: "feed.png",
        label: function() {
            return this.name||"youless";
        },
        inputLabels: "trigger",
        outputLabels: ["measurements"]
    });
</script>

<script type="text/x-red" data-template-name="youless">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-ip"><i class="icon-tag"></i> IP Address</label>
        <input type="text" id="node-input-ipaddress" placeholder="x.x.x.x">
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="icon-tag"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
    <label for="node-input-page"><i class="icon-tag"></i> Page</label>
    <select id="node-input-page">
        <option value="/e?f=j/">/e?f=j/ /// this shows the upload values from the json /e page on the Youless.</option>
        <option value="/f?f=j/">/f?f=j/ /// info info per phase /f page in json.</option>
        <option value="/a?f=j/">/a?f=j/ /// status info report.</option>
        <option value="/d?f=j/">/d?f=j/ /// system info: Mac Firmware version.</option>
    </select>
    </div>

    <div class="form-row">
        <label for="node-input-password"><i class="icon-tag"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>

<script type="text/x-red" data-help-name="youless">
    <p>Connector for the Youless LS120 device.</p>
    Enter your device ip and optional password in the node settings. Attach a trigger to the input to receive Youless data.<br/>
    The following values are reported. Each value type has its own output port (hover to see name), which sends a payload to the specified topic.
    <p>Available values:</p>
    <ul>
        <li>cnt: counter in kWh</li>
        <li>pwr: Pwer consumption in Watt</li>
        <li>lvl: moving average level (intensity of reflected light on analog meters)</li>
        <li>dev: deviation of reflection</li>
        <li>det: </li>
        <li>con: connection status</li>
        <li>sts: Time until next status update with online monitoring</li>
        <li>cs0: kWh counter of S0 input</li>
        <li>ps0: Computed power</li>
        <li>raw: raw 10-bit light reflection level (without averaging)</li>
    </ul>
</script>


